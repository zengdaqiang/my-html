<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生日祝福网页制作平台</title>
    <!-- 引入图标库 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        
        :root {
            /* 主色调：温暖粉色系（生日氛围） */
            --primary: #ff6b8b;
            --primary-light: #ff8fa7;
            --primary-dark: #e05575;
            /* 辅助色 */
            --secondary: #8b5cf6;
            --secondary-light: #a78bfa;
            /* 中性色 */
            --white: #ffffff;
            --gray-100: #f9fafb;
            --gray-200: #f3f4f6;
            --gray-300: #e5e7eb;
            --gray-400: #d1d5db;
            --gray-500: #9ca3af;
            --gray-600: #6b7280;
            --gray-700: #4b5563;
            --gray-800: #374151;
            --gray-900: #1f2937;
            /* 强调色 - 用于高亮交互元素 */
            --accent: #ffc107;
            /* 阴影 */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 6px 12px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --shadow-hover: 0 12px 30px rgba(255, 107, 139, 0.2);
            /* 圆角 */
            --radius-sm: 6px;
            --radius: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            /* 过渡 */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", "微软雅黑", "PingFang SC", sans-serif;
        }

        body {
            background-color: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.5;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 139, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.05) 0%, transparent 20%);
            background-attachment: fixed;
        }

        /* 顶部导航 */
        .top-nav {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.9));
            backdrop-filter: blur(12px);
            color: var(--gray-800);
            padding: 12px 20px;
            font-size: 14px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .top-nav.scroll {
            padding: 8px 20px;
            box-shadow: var(--shadow);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 18px;
            color: var(--primary);
            transition: var(--transition);
        }

        .nav-logo:hover {
            transform: scale(1.05);
        }

        .nav-logo i {
            font-size: 22px;
            animation: bounce 2s infinite alternate;
        }

        .nav-links {
            display: flex;
            gap: 28px;
        }

        .nav-links a {
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 4px 0;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
            border-radius: 1px;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-links a.active {
            color: var(--primary);
        }

        .nav-links a.active::after {
            width: 100%;
        }

        .nav-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            outline: none;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            position: relative;
            overflow: hidden;
        }

        .btn-outline::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 139, 0.1), transparent);
            transition: var(--transition);
        }

        .btn-outline:hover {
            background-color: rgba(255, 107, 139, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 107, 139, 0.1);
        }

        .btn-outline:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(255, 107, 139, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        /* 头部banner */
        .banner {
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.4)), 
                        url("https://picsum.photos/id/1042/1920/600") no-repeat center;
            background-size: cover;
            height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--white);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 107, 139, 0.2), transparent 70%);
            z-index: 1;
        }

        .banner-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            animation: float 6s infinite ease-in-out;
        }

        .banner-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: 0 20px;
        }

        .banner h1 {
            font-size: 48px;
            margin-bottom: 16px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease-out;
            background: linear-gradient(120deg, var(--white), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .banner p {
            font-size: 20px;
            margin-bottom: 32px;
            opacity: 0.9;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .banner-tag {
            display: inline-block;
            padding: 6px 16px;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            border-radius: var(--radius-full);
            font-size: 14px;
            margin-bottom: 24px;
            animation: fadeInUp 1s ease-out 0.6s both;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .banner-tag:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* 表单区域 */
        .form-section {
            max-width: 900px;
            margin: -60px auto 60px;
            padding: 0 20px;
            position: relative;
            z-index: 20;
        }

        .page-shell {
            position: relative;
        }

        body.is-celebrating {
            background: #0b0f19;
        }

        body.is-celebrating .page-shell {
            display: none;
        }

        .form-card {
            background-color: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 40px;
            overflow: hidden;
            position: relative;
            transition: var(--transition);
        }

        .form-layout {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
            gap: 24px;
        }

        @media (max-width: 1080px) {
            .form-layout {
                grid-template-columns: 1fr;
            }
        }

        .preview-card {
            background: linear-gradient(165deg, #1b1f3a, #351f54 55%, #5c1f6c);
            border-radius: var(--radius-lg);
            box-shadow: 0 25px 60px rgba(27, 31, 58, 0.45);
            padding: 36px;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        .preview-card::before,
        .preview-card::after {
            content: "";
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.4;
            z-index: 0;
        }

        .preview-card::before {
            width: 220px;
            height: 220px;
            background: rgba(255, 107, 139, 0.6);
            top: -60px;
            right: -60px;
        }

        .preview-card::after {
            width: 280px;
            height: 280px;
            background: rgba(138, 92, 246, 0.5);
            bottom: -80px;
            left: -40px;
        }

        .preview-inner {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .preview-tag {
            padding: 6px 14px;
            border-radius: var(--radius-full);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 12px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .preview-mode {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .preview-title {
            font-size: 26px;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 18px;
        }

        .preview-recipient {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }

        .preview-message {
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--radius);
            padding: 20px;
            font-size: 15px;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.85);
            flex: 1;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
        }

        .preview-footer {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .preview-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .preview-meta span {
            font-size: 12px;
            padding: 6px 14px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .preview-sender {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.75);
        }

        .preview-badges {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .preview-badge {
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--radius);
            padding: 10px 12px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-card:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-3px);
        }

        .form-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .form-card::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--primary-light) 0%, transparent 70%);
            opacity: 0.05;
            border-radius: 50%;
            transform: translate(50%, 50%);
            z-index: 0;
        }

        .step {
            text-align: center;
            margin-bottom: 32px;
            position: relative;
            z-index: 1;
        }

        .step-tools {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 18px;
            gap: 12px;
        }

        .btn-ghost {
            background: rgba(255, 107, 139, 0.08);
            color: var(--primary);
            border: 1px dashed rgba(255, 107, 139, 0.5);
        }

        .btn-ghost:hover {
            background: rgba(255, 107, 139, 0.15);
        }

        .step-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            font-size: 20px;
            margin-bottom: 12px;
            box-shadow: 0 4px 15px rgba(255, 107, 139, 0.3);
            animation: pulse 2s infinite alternate;
        }

        .step h3 {
            font-size: 22px;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .step p {
            color: var(--gray-500);
            font-size: 14px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-700);
            font-size: 14px;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-label.required::after {
            content: "*";
            color: var(--primary);
            font-size: 16px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 15px;
            color: var(--gray-800);
            transition: var(--transition);
            background-color: var(--gray-50);
            position: relative;
            z-index: 1;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 139, 0.15);
            background-color: var(--white);
            transform: translateY(-1px);
        }

        .form-input:hover,
        .form-textarea:hover {
            border-color: var(--primary-light);
            background-color: var(--white);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-hint {
            display: block;
            margin-top: 6px;
            font-size: 12px;
            color: var(--gray-500);
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-hint i {
            font-size: 10px;
        }

        .form-hint.text-red-500 {
            color: #ef4444;
            font-weight: 500;
        }

        /* 音乐上传样式 */
        .music-upload-group {
            display: flex;
            gap: 12px;
            align-items: stretch;
            position: relative;
            z-index: 1;
        }

        .music-file-input {
            display: none;
        }

        .music-file-label {
            flex: 1;
            padding: 14px 16px;
            border: 1px dashed var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 15px;
            color: var(--gray-600);
            transition: var(--transition);
            background-color: var(--gray-50);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .music-file-label:hover {
            border-color: var(--primary);
            background-color: rgba(255, 107, 139, 0.05);
        }

        .music-file-label i {
            color: var(--primary);
        }

        .file-name {
            color: var(--gray-800);
            font-weight: 500;
        }

        .btn-upload {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            color: var(--white);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            padding: 0 20px;
            position: relative;
            overflow: hidden;
        }

        .btn-upload::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .btn-upload:hover {
            background: linear-gradient(135deg, var(--secondary-light), var(--secondary));
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
        }

        .btn-upload:hover::before {
            left: 100%;
        }

        .btn-create {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(255, 107, 139, 0.3);
            margin-top: 16px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-create::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .btn-create:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            box-shadow: var(--shadow-hover);
            transform: translateY(-3px);
        }

        .btn-create:hover::before {
            left: 100%;
        }

        .btn-create:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 139, 0.3);
        }

        .btn-create:disabled {
            background: linear-gradient(135deg, var(--gray-400), var(--gray-500));
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
            opacity: 0.8;
        }

        .theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .theme-pill {
            position: relative;
            padding: 12px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--gray-300);
            min-width: 150px;
            background: var(--white);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .theme-pill:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(255, 107, 139, 0.12);
        }

        .theme-pill input {
            display: none;
        }

        .theme-pill span {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
        }

        .theme-pill small {
            display: block;
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .theme-pill input:checked + span {
            color: var(--primary);
        }

        .theme-pill input:checked + span::after {
            content: " · 已选";
            font-size: 11px;
            color: var(--primary);
            font-weight: 500;
        }

        .floating-cta {
            position: fixed;
            right: 28px;
            bottom: 28px;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: var(--white);
            padding: 12px 20px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-lg);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            z-index: 99;
            transition: var(--transition);
        }

        .floating-cta:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-hover);
        }

        body.is-celebrating .floating-cta {
            display: none;
        }

        .info-section {
            background: var(--gray-100);
            padding: 80px 20px;
        }

        .info-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
        }

        .info-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow);
            transition: var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .info-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
        }

        .info-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 18px;
            font-size: 20px;
            color: var(--primary);
            background: rgba(255, 107, 139, 0.12);
        }

        .timeline {
            max-width: 1100px;
            margin: 0 auto;
            padding: 80px 20px;
        }

        .timeline h2 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 30px;
            color: var(--gray-900);
        }

        .timeline-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }

        .timeline-step {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
        }

        .timeline-step span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: rgba(255, 107, 139, 0.1);
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 16px;
        }

        .faq-section {
            padding: 80px 20px;
            background: var(--white);
        }

        .faq-grid {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .faq-item {
            padding: 24px;
            border-radius: var(--radius);
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
        }

        .faq-item h4 {
            margin-bottom: 12px;
            color: var(--gray-900);
        }

        footer {
            background: var(--gray-900);
            color: rgba(255, 255, 255, 0.8);
            padding: 40px 20px;
            text-align: center;
        }

        footer p {
            margin-top: 12px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 12, 24, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .loading-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .loading-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 32px 40px;
            text-align: center;
            color: var(--white);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--accent);
            margin: 0 auto 16px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0); }
            to { transform: rotate(360deg); }
        }

        /* 说明区域 */
        .desc-section {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
            color: var(--white);
            padding: 80px 20px;
            position: relative;
            overflow: hidden;
        }

        .desc-section .highlight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 30px;
        }

        .desc-section article {
            background: rgba(255,255,255,0.12);
            border-radius: var(--radius-lg);
            padding: 30px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 45px rgba(0,0,0,0.15);
        }

        /* 祝福页面样式 */
        #birthdayPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            padding: 32px;
        }

        .celebration-actions {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .celebration-actions .btn {
            background: rgba(255, 255, 255, 0.85);
            color: var(--primary);
            border: none;
            font-weight: 600;
            padding: 10px 18px;
        }

        .celebration-actions .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .share-toast {
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: rgba(13, 18, 34, 0.9);
            color: var(--white);
            padding: 10px 16px;
            border-radius: var(--radius-full);
            font-size: 13px;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            z-index: 20;
        }

        .share-toast.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        #birthdayPage * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimHei", "Microsoft YaHei", sans-serif;
        }

        #birthdayPage body {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #fff9f0 0%, #fff0e0 100%);
            position: relative;
        }

        .bg-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(#ffccd5 1px, transparent 1px),
                radial-gradient(#ffccd5 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            opacity: 0.3;
            z-index: 0;
        }

        .falling-decor {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .falling {
            position: absolute;
            opacity: 0;
            animation: falling linear infinite;
        }

        @keyframes falling {
            0% { transform: translateY(-10%) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }

        .candles {
            position: absolute;
            z-index: 3;
            opacity: 0;
        }

        .candle {
            position: absolute;
            width: 10px;
            height: 50px;
            border-radius: 3px;
            background: #ffffff;
            transform: scaleY(0);
            transition: transform 0.5s ease;
        }

        .candle-holder {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 5px;
            background: #d4af37;
            border-radius: 1px;
        }

        .candle-wick {
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 8px;
            background: #333;
        }

        .flame {
            position: absolute;
            width: 8px;
            height: 15px;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle, #fff3bf, #ff9800 70%);
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.6),
                        0 0 25px rgba(255, 152, 0, 0.3);
            opacity: 0;
            animation: flicker 1s infinite alternate;
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(0.9) rotate(-5deg); }
            100% { transform: translateX(-50%) scale(1.1) rotate(5deg); }
        }

        .floating-elements {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 4;
        }

        .floating {
            position: absolute;
            opacity: 0;
            transform: scale(0.6) translateY(20px);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(3deg); }
        }

        .text-container {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-direction: column;
            z-index: 5;
            pointer-events: none;
            padding: 40px 20px clamp(220px, 32vh, 360px);
            gap: 24px;
        }

        .celebration-card {
            width: min(620px, 92vw);
            background: rgba(255, 255, 255, 0.85);
            border-radius: 30px;
            padding: 32px;
            text-align: center;
            box-shadow: 0 35px 90px rgba(15, 20, 45, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(14px);
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }

        .card-controls {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-bottom: 12px;
        }

        .music-toggle {
            border: none;
            border-radius: var(--radius-full);
            padding: 6px 14px;
            font-size: 13px;
            cursor: pointer;
            background: rgba(15, 23, 42, 0.08);
            color: #0f172a;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition-fast);
        }

        .music-toggle:hover {
            background: rgba(15, 23, 42, 0.12);
        }

        .music-toggle[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .celebration-card::after {
            content: "";
            position: absolute;
            inset: 12px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            pointer-events: none;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-chip {
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 12px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            background: linear-gradient(120deg, rgba(255, 107, 139, 0.18), rgba(139, 92, 246, 0.25));
            color: #e23320;
            font-weight: 600;
        }

        .card-date {
            font-size: 13px;
            color: rgba(15, 23, 42, 0.6);
        }

        .hero-media {
            width: 100%;
            aspect-ratio: 16 / 9;
            border-radius: 20px;
            background-size: cover;
            background-position: center;
            margin-bottom: 22px;
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.18);
            border: 1px solid rgba(255, 255, 255, 0.6);
            overflow: hidden;
            position: relative;
        }

        .hero-media::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.25));
        }

        .hero-media.hidden {
            display: none;
        }

        .main-text {
            font-size: clamp(2rem, 3vw, 2.8rem);
            font-weight: 900;
            color: #0f172a;
            margin-bottom: 12px;
            text-shadow: 0 8px 30px rgba(15,23,42,0.15);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }

        .sub-text {
            font-size: 1.2rem;
            color: #334155;
            margin: 6px 0;
            line-height: 1.8;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .sub-text.memory {
            font-size: 1rem;
            color: #475569;
            background: rgba(15, 23, 42, 0.03);
            border-radius: 16px;
            padding: 12px 18px;
            margin-top: 12px;
        }

        .signature {
            font-size: 1rem;
            color: #0f172a;
            margin-top: 24px;
            letter-spacing: 0.2em;
        }

        .card-footer {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
            font-size: 0.95rem;
            color: #475569;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .sprinkle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 3px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            z-index: 3;
        }

        @media (max-width: 768px) {
            .celebration-card {
                padding: 24px;
            }
        }

        /* 动画关键帧 */
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
    </style>
    
</head>
<body>
    <div class="page-shell">
        <!-- 顶部导航 -->
        <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-birthday-cake"></i>
                <span>生日祝福网页制作平台</span>
            </div>
            <div class="nav-links">
                <a href="#" class="active">首页</a>
                <a href="#">模板</a>
                <a href="#">教程</a>
                <a href="#">帮助</a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-outline"><i class="fas fa-history"></i> 我的作品</button>
                <button class="btn btn-primary"><i class="fas fa-user"></i> 登录</button>
            </div>
        </div>
    </nav>

    <!-- 头部banner -->
    <div class="banner">
        <div class="banner-particles"></div>
        <div class="banner-content">
            <span class="banner-tag">简单几步，制作专属生日祝福</span>
            <h1>为TA创建一份特别的生日祝福</h1>
            <p>无需设计经验，轻松制作精美的生日祝福网页，给朋友和家人一个惊喜</p>
            <button class="btn btn-primary scroll-to-form"><i class="fas fa-magic"></i> 立即开始</button>
        </div>
    </div>

    <!-- 表单区域 -->
    <section class="form-section" id="create">
        <div class="form-layout">
            <div class="form-card">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-pen"></i>
                    </div>
                    <h3>填写祝福信息</h3>
                    <p>输入生日祝福的相关内容，定制专属于TA的祝福页面</p>
                </div>

                <div class="step-tools">
                    <button type="button" class="btn btn-ghost" id="fillSampleBtn">
                        <i class="fas fa-feather"></i> 填入示例祝福
                    </button>
                </div>

                <form id="birthdayForm" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">祝福标题</label>
                            <input type="text" class="form-input" name="title" placeholder="例如：生日快乐，我的朋友" required>
                            <span class="form-hint"><i class="fas fa-info-circle"></i> 祝福页面的主标题</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">收件人</label>
                            <input type="text" class="form-input" name="recipient" placeholder="输入TA的名字" required>
                            <span class="form-hint"><i class="fas fa-info-circle"></i> 祝福的对象</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">副标题</label>
                        <input type="text" class="form-input" name="subtitle" placeholder="例如：献给最闪耀的你">
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 可选，用于祝福页面副标题</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">祝福内容</label>
                        <textarea class="form-textarea" name="message" placeholder="写下你想对TA说的话..." required></textarea>
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 表达你的真挚祝福</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">难忘瞬间</label>
                        <textarea class="form-textarea" name="memory" placeholder="记录一段属于你们的记忆，可选"></textarea>
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 让页面更有故事感</span>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">祝福日期</label>
                            <input type="date" class="form-input" name="wishDate">
                            <span class="form-hint"><i class="fas fa-info-circle"></i> 可选，会显示在祝福页面中</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">署名</label>
                            <input type="text" class="form-input" name="sender" placeholder="你的名字或昵称">
                            <span class="form-hint"><i class="fas fa-info-circle"></i> 可选，祝福的落款</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">祝福主题</label>
                        <div class="theme-options">
                            <label class="theme-pill">
                                <input type="radio" name="theme" value="sunrise" checked>
                                <span>晨曦花园</span>
                                <small>柔和暖色，温柔明亮</small>
                            </label>
                            <label class="theme-pill">
                                <input type="radio" name="theme" value="aurora">
                                <span>极光星河</span>
                                <small>梦幻星空，光影律动</small>
                            </label>
                            <label class="theme-pill">
                                <input type="radio" name="theme" value="ocean">
                                <span>海风派对</span>
                                <small>蓝绿色调，清爽活力</small>
                            </label>
                        </div>
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 一键切换祝福页面配色氛围</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">上传背景图片</label>
                        <input type="file" class="form-input" name="image" accept="image/*">
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 可选，为祝福页面添加背景图片</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">背景音乐</label>
                        <div class="music-upload-group">
                            <label class="music-file-label" for="musicFile">
                                <i class="fas fa-music"></i>
                                <span id="musicFileName">选择音乐文件</span>
                            </label>
                            <input type="file" id="musicFile" class="music-file-input" name="music" accept="audio/*">
                            <button type="button" class="btn btn-upload" id="defaultMusicBtn">
                                <i class="fas fa-music"></i> 选择默认音乐
                            </button>
                        </div>
                        <span class="form-hint"><i class="fas fa-info-circle"></i> 可选，为祝福页面添加背景音乐</span>
                    </div>

                    <button type="submit" class="btn-create">
                        <i class="fas fa-gift"></i> 生成生日祝福
                    </button>
                </form>
            </div>

            <aside class="preview-card">
                <div class="preview-inner">
                    <div class="preview-header">
                        <span class="preview-tag">实时预览</span>
                        <div class="preview-mode">
                            <i class="fas fa-desktop"></i>
                            <span id="previewThemeBadge">晨曦花园</span>
                        </div>
                    </div>
                    <div class="preview-recipient" id="previewRecipient">送给 · 最亲爱的TA</div>
                    <div class="preview-title" id="previewTitle">生日快乐，我的朋友</div>
                    <div class="preview-message" id="previewMessage">写下祝福内容，实时预览呈现效果。</div>
                    <div class="preview-footer">
                        <div class="preview-meta">
                            <span id="previewDate">祝福日期 · 待设置</span>
                            <span id="previewMemory">回忆 · 暂无内容</span>
                        </div>
                        <div class="preview-badges">
                            <div class="preview-badge" id="previewBadge1">音乐未选择</div>
                            <div class="preview-badge" id="previewBadge2">图片未上传</div>
                        </div>
                        <div class="preview-sender" id="previewSender">—— 来自：你的朋友</div>
                    </div>
                </div>
            </aside>
        </div>
    </section>

    <!-- 说明区域 -->
    <section class="desc-section">
        <div style="max-width: 1200px; margin: 0 auto; position: relative; z-index: 1;">
            <h2 style="text-align: center; margin-bottom: 40px; font-size: 32px; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">为什么选择我们的生日祝福平台</h2>
            <div class="highlight-grid">
                <article>
                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                        <i class="fas fa-bolt" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h3>操作简单</h3>
                    <p style="opacity: 0.9; line-height: 1.6;">无需任何设计或编程经验，只需填写信息，即可生成精美的生日祝福页面。</p>
                </article>
                <article>
                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                        <i class="fas fa-paint-brush" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h3>精美设计</h3>
                    <p style="opacity: 0.9; line-height: 1.6;">专业设计师打造的模板，结合动态效果，让祝福更具视觉冲击力。</p>
                </article>
                <article>
                    <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                        <i class="fas fa-share-alt" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h3>轻松分享</h3>
                    <p style="opacity: 0.9; line-height: 1.6;">生成的祝福页面可以直接分享给朋友，让TA随时随地收到你的祝福。</p>
                </article>
            </div>
        </div>
    </section>

    <section class="info-section">
        <div class="info-grid">
            <div class="info-card">
                <div class="info-icon"><i class="fas fa-wand-magic-sparkles"></i></div>
                <h3>多主题氛围</h3>
                <p>内置多种祝福场景主题，一键切换不同的配色与灯光效果。</p>
            </div>
            <div class="info-card">
                <div class="info-icon"><i class="fas fa-music"></i></div>
                <h3>音乐彩蛋</h3>
                <p>上传专属音乐或使用精选默认曲目，打造声画并茂的祝福体验。</p>
            </div>
            <div class="info-card">
                <div class="info-icon"><i class="fas fa-share-nodes"></i></div>
                <h3>一键分享</h3>
                <p>生成后的祝福支持复制祝福词、重播动画，让传递快乐更轻松。</p>
            </div>
            <div class="info-card">
                <div class="info-icon"><i class="fas fa-shield-heart"></i></div>
                <h3>数据本地</h3>
                <p>所有信息只在本地浏览器处理中，不会上传到服务器，安全放心。</p>
            </div>
        </div>
    </section>

    <section class="timeline">
        <h2>三步打造惊喜生日网页</h2>
        <div class="timeline-steps">
            <div class="timeline-step">
                <span>1</span>
                <h3>填写祝福</h3>
                <p>完善标题、内容、照片、音乐等信息，实时预览效果。</p>
            </div>
            <div class="timeline-step">
                <span>2</span>
                <h3>生成页面</h3>
                <p>点击生成后，系统自动注入动画、场景和烟花特效。</p>
            </div>
            <div class="timeline-step">
                <span>3</span>
                <h3>分享欢乐</h3>
                <p>通过复制祝福语或邀请TA现场观看，分享这份惊喜。</p>
            </div>
        </div>
    </section>

    <section class="faq-section">
        <div style="text-align: center; margin-bottom: 40px;">
            <h2 style="font-size: 30px; color: var(--gray-900);">常见问题</h2>
            <p style="color: var(--gray-600); margin-top: 8px;">快速了解平台使用方式</p>
        </div>
        <div class="faq-grid">
            <div class="faq-item">
                <h4>生成的页面是否需要联网？</h4>
                <p>页面在本地渲染，生成后即可离线播放，但音乐流地址需要联网。</p>
            </div>
            <div class="faq-item">
                <h4>可以重复编辑吗？</h4>
                <p>可以，返回编辑界面后修改信息再次生成即可。</p>
            </div>
            <div class="faq-item">
                <h4>如何分享给好友？</h4>
                <p>点击“复制祝福”按钮即可复制祝福文案，或邀请TA现场观看。</p>
            </div>
        </div>
    </section>

    <footer>
        <strong>生日祝福网页制作平台</strong>
        <p>用科技包装真心，用创意点亮祝福 · 2025</p>
    </footer>
    </div>

    <a class="floating-cta" href="#create">
        <i class="fas fa-sparkles"></i> 立即创建祝福
    </a>

    <!-- 生日祝福展示页面容器 -->
    <div id="birthdayPage">
        <div class="celebration-actions">
            <button class="btn btn-outline" id="backHomeBtn"><i class="fas fa-arrow-left"></i> 返回编辑</button>
            <button class="btn btn-outline" id="replayBtn"><i class="fas fa-rotate-right"></i> 重播动画</button>
            <button class="btn btn-primary" id="shareBtn"><i class="fas fa-copy"></i> 复制祝福</button>
        </div>
        <div class="share-toast" id="shareToast">祝福内容已复制</div>
        <div class="bg-pattern"></div>
        <div class="falling-decor" id="fallingDecor"></div>
        
        <canvas id="cakeCanvas"></canvas>
        
        <div class="candles" id="candles"></div>
        <div id="sprinklesContainer" style="position: absolute; width: 100%; height: 100%; z-index: 3; pointer-events: none;"></div>
        
        <div class="floating-elements" id="floatContainer"></div>
        
        <div class="text-container">
            <div class="celebration-card" id="celebrationCard">
                <div class="card-controls">
                    <button type="button" class="music-toggle" id="musicToggleBtn">
                        <i class="fas fa-volume-up"></i>
                        背景音乐已开启
                    </button>
                </div>
                <div class="card-header">
                    <span class="card-chip" id="cardThemeChip">专属祝福</span>
                    <span class="card-date" id="cardDate"></span>
                </div>
                <div class="hero-media hidden" id="heroMedia"></div>
                <div class="main-text" id="mainText">生日快乐！</div>
                <div class="sub-text" id="sub1">Happy Birthday!</div>
                <div class="sub-text" id="sub2">愿所有美好如期而至</div>
                <div class="sub-text memory" id="sub3"></div>
                <div class="signature" id="sub4"></div>
                <div class="card-footer">
                    <span id="cardRecipient">送给 · 最亲爱的TA</span>
                </div>
            </div>
        </div>
        <!-- 音频元素将在这里动态创建 -->
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-card">
            <div class="loading-spinner"></div>
            <p>正在打造生日惊喜...</p>
        </div>
    </div>

    <script>
        const nav = document.querySelector('.top-nav');
        window.addEventListener('scroll', () => {
            nav.classList.toggle('scroll', window.scrollY > 10);
        });

        const scrollTriggers = document.querySelectorAll('.scroll-to-form, .floating-cta');
        scrollTriggers.forEach(trigger => {
            trigger.addEventListener('click', (event) => {
                event.preventDefault();
                document.getElementById('create').scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        const birthdayForm = document.getElementById('birthdayForm');
        const birthdayPage = document.getElementById('birthdayPage');
        const loadingOverlay = document.getElementById('loadingOverlay');

        const musicFileInput = document.getElementById('musicFile');
        const musicFileName = document.getElementById('musicFileName');
        const defaultMusicBtn = document.getElementById('defaultMusicBtn');
        const imageInput = birthdayForm.querySelector('input[name="image"]');
        const themeInputs = birthdayForm.querySelectorAll('input[name="theme"]');

        const previewRefs = {
            title: document.getElementById('previewTitle'),
            recipient: document.getElementById('previewRecipient'),
            message: document.getElementById('previewMessage'),
            sender: document.getElementById('previewSender'),
            date: document.getElementById('previewDate'),
            memory: document.getElementById('previewMemory'),
            badge1: document.getElementById('previewBadge1'),
            badge2: document.getElementById('previewBadge2'),
            theme: document.getElementById('previewThemeBadge')
        };

        const celebrationRefs = {
            main: document.getElementById('mainText'),
            sub1: document.getElementById('sub1'),
            sub2: document.getElementById('sub2'),
            sub3: document.getElementById('sub3'),
            sub4: document.getElementById('sub4'),
            pattern: document.querySelector('#birthdayPage .bg-pattern'),
            media: document.getElementById('heroMedia'),
            chip: document.getElementById('cardThemeChip'),
            date: document.getElementById('cardDate'),
            card: document.getElementById('celebrationCard'),
            recipient: document.getElementById('cardRecipient')
        };

        const actionButtons = {
            back: document.getElementById('backHomeBtn'),
            replay: document.getElementById('replayBtn'),
            share: document.getElementById('shareBtn'),
            toast: document.getElementById('shareToast')
        };

        const sampleBtn = document.getElementById('fillSampleBtn');
        const musicToggleBtn = document.getElementById('musicToggleBtn');

        const themeNames = {
            sunrise: '晨曦花园',
            aurora: '极光星河',
            ocean: '海风派对'
        };

        const themeConfigs = {
            sunrise: {
                background: 'radial-gradient(ellipse at center, #fff5f7 0%, #ffe0e8 100%)',
                pattern: 'radial-gradient(#ffcbd7 1px, transparent 1px), radial-gradient(#ffdfe8 1px, transparent 1px)',
                heading: '#f45c75',
                sub: '#ff9eb3',
                message: '#ff6b8b',
                memory: '#fba7a1',
                cardBackground: 'linear-gradient(145deg, rgba(255,255,255,0.96), rgba(255,245,248,0.9))',
                chipBg: 'rgba(255, 224, 234, 0.9)',
                chipBgAlt: 'rgba(255, 244, 249, 0.9)',
                cardShadow: 'rgba(255, 107, 139, 0.35)'
            },
            aurora: {
                background: 'radial-gradient(circle at top, #0f172a 0%, #1d1b3a 60%, #0b1020 100%)',
                pattern: 'radial-gradient(#7dd3fc 1px, transparent 1px), radial-gradient(#c084fc 1px, transparent 1px)',
                heading: '#c084fc',
                sub: '#7dd3fc',
                message: '#f472b6',
                memory: '#a5b4fc',
                cardBackground: 'linear-gradient(160deg, rgba(15,23,42,0.85), rgba(30,41,59,0.78))',
                chipBg: 'rgba(148, 163, 255, 0.2)',
                chipBgAlt: 'rgba(236, 72, 153, 0.18)',
                cardShadow: 'rgba(96, 165, 250, 0.35)'
            },
            ocean: {
                background: 'radial-gradient(circle at center, #e0fbff 0%, #c2f0ff 55%, #8ed6ff 100%)',
                pattern: 'radial-gradient(#0ea5e9 1px, transparent 1px), radial-gradient(#38bdf8 1px, transparent 1px)',
                heading: '#0284c7',
                sub: '#0f766e',
                message: '#0ea5e9',
                memory: '#14b8a6',
                cardBackground: 'linear-gradient(140deg, rgba(255,255,255,0.95), rgba(219, 244, 255, 0.9))',
                chipBg: 'rgba(125, 211, 252, 0.25)',
                chipBgAlt: 'rgba(45, 212, 191, 0.22)',
                cardShadow: 'rgba(14, 165, 233, 0.32)'
            }
        };

        let selectedMusic = null;
        let useDefaultMusic = false;
        let stopAnimation = null;
        let activeAudio = null;
        let audioUnlockHandler = null;
        let lastBirthdayData = null;

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (Number.isNaN(date.getTime())) return dateStr;
            const pad = (num) => String(num).padStart(2, '0');
            return `${date.getFullYear()}.${pad(date.getMonth() + 1)}.${pad(date.getDate())}`;
        }

        function toggleLoading(show) {
            loadingOverlay.classList.toggle('visible', show);
        }

        function setMusicControlVisible(visible) {
            if (!musicToggleBtn) return;
            musicToggleBtn.style.display = visible ? 'inline-flex' : 'none';
            musicToggleBtn.disabled = !visible;
        }

        function setMusicToggleLabel(iconClass, text) {
            if (!musicToggleBtn) return;
            musicToggleBtn.innerHTML = `<i class="fas ${iconClass}"></i>${text}`;
        }

        function syncMusicToggleState() {
            if (!musicToggleBtn) return;
            if (!activeAudio) {
                setMusicControlVisible(false);
                return;
            }
            musicToggleBtn.disabled = false;
            if (activeAudio.paused) {
                setMusicToggleLabel('fa-volume-mute', ' 背景音乐已静音');
            } else {
                setMusicToggleLabel('fa-volume-up', ' 背景音乐已开启');
            }
        }

        function updatePreview() {
            const formData = new FormData(birthdayForm);
            const title = (formData.get('title') || '').trim();
            const recipient = (formData.get('recipient') || '').trim();
            const subtitle = (formData.get('subtitle') || '').trim();
            const message = (formData.get('message') || '').trim();
            const memory = (formData.get('memory') || '').trim();
            const sender = (formData.get('sender') || '').trim();
            const wishDate = formData.get('wishDate');
            const theme = formData.get('theme') || 'sunrise';

            const finalTitle = recipient ? `${recipient} · ${title || '生日快乐'}` : (title || '生日快乐，我的朋友');
            const heroLine = subtitle || (recipient ? `送给 · ${recipient}` : '送给 · 最亲爱的TA');

            previewRefs.recipient.textContent = heroLine;
            previewRefs.title.textContent = finalTitle;
            previewRefs.message.textContent = message || '写下祝福内容，实时预览呈现效果。';
            previewRefs.sender.textContent = sender ? `—— 来自：${sender}` : '—— 来自：你的朋友';
            previewRefs.date.textContent = wishDate ? `祝福日期 · ${formatDate(wishDate)}` : '祝福日期 · 待设置';
            previewRefs.memory.textContent = memory ? `回忆 · ${memory}` : '回忆 · 暂无内容';
            previewRefs.theme.textContent = themeNames[theme] || themeNames.sunrise;
        }

        function updateMediaBadges() {
            const hasMusic = useDefaultMusic || Boolean(selectedMusic);
            previewRefs.badge1.textContent = hasMusic ? '音乐已就绪' : '音乐未选择';
            previewRefs.badge2.textContent = imageInput.files.length > 0 ? '图片已上传' : '图片未上传';
        }

        musicFileInput.addEventListener('change', (event) => {
            if (event.target.files.length > 0) {
                selectedMusic = event.target.files[0];
                useDefaultMusic = false;
                musicFileName.textContent = selectedMusic.name;
                musicFileName.classList.add('file-name');
            } else {
                selectedMusic = null;
            }
            updateMediaBadges();
        });

        defaultMusicBtn.addEventListener('click', () => {
            musicFileName.textContent = '使用默认生日音乐';
            musicFileName.classList.add('file-name');
            selectedMusic = null;
            useDefaultMusic = true;
            updateMediaBadges();
        });

        imageInput.addEventListener('change', updateMediaBadges);
        themeInputs.forEach(radio => radio.addEventListener('change', updatePreview));

        birthdayForm.querySelectorAll('input, textarea, select').forEach(field => {
            field.addEventListener('input', updatePreview);
            field.addEventListener('change', updatePreview);
        });

        updatePreview();
        updateMediaBadges();

        setMusicControlVisible(false);

        if (musicToggleBtn) {
            musicToggleBtn.addEventListener('click', () => {
                if (!activeAudio) return;
                if (activeAudio.paused) {
                    activeAudio.play()
                        .then(() => {
                            syncMusicToggleState();
                        })
                        .catch(() => showShareToast('播放失败，请尝试点击页面任意位置'));
                } else {
                    activeAudio.pause();
                    syncMusicToggleState();
                }
            });
        }

        if (sampleBtn) {
            sampleBtn.addEventListener('click', () => {
                const sample = {
                    title: '生日快乐！我的朋友',
                    recipient: '星河',
                    subtitle: '献给最闪耀的你',
                    message: '今天是你的高光时刻，愿所有的欢笑、所有的好运、所有的浪漫都环绕在你身边。请把所有烦恼留在昨天，未来的每一步都坚定而自信。',
                    memory: '记得那年夏天一起追逐烟火的夜晚吗？那份悸动在今天也同样闪烁，提醒我珍惜与你的每一个瞬间。',
                    sender: '挚友 · 阿七',
                    theme: 'aurora'
                };

                const now = new Date();
                const isoDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

                birthdayForm.elements['title'].value = sample.title;
                birthdayForm.elements['recipient'].value = sample.recipient;
                birthdayForm.elements['subtitle'].value = sample.subtitle;
                birthdayForm.elements['message'].value = sample.message;
                birthdayForm.elements['memory'].value = sample.memory;
                birthdayForm.elements['sender'].value = sample.sender;
                birthdayForm.elements['wishDate'].value = isoDate;

                themeInputs.forEach(radio => {
                    radio.checked = radio.value === sample.theme;
                });

                useDefaultMusic = true;
                selectedMusic = null;
                musicFileInput.value = '';
                musicFileName.textContent = '使用默认生日音乐';
                musicFileName.classList.add('file-name');

                imageInput.value = '';

                updatePreview();
                updateMediaBadges();
            });
        }

        actionButtons.back.addEventListener('click', resetToHome);
        actionButtons.replay.addEventListener('click', () => {
            if (!lastBirthdayData) return;
            startBirthdayAnimation();
        });
        actionButtons.share.addEventListener('click', copyBlessingToClipboard);

        birthdayForm.addEventListener('submit', (event) => {
            event.preventDefault();
            toggleLoading(true);

            const formData = new FormData(birthdayForm);
            const title = (formData.get('title') || '').trim();
            const recipient = (formData.get('recipient') || '').trim();
            const subtitle = (formData.get('subtitle') || '').trim();
            const message = (formData.get('message') || '').trim();
            const memory = (formData.get('memory') || '').trim();
            const sender = (formData.get('sender') || '').trim();
            const wishDate = formData.get('wishDate');
            const theme = formData.get('theme') || 'sunrise';

            const finalTitle = recipient ? `${recipient} · ${title || '生日快乐'}` : (title || '生日快乐');

            const birthdayData = {
                title: finalTitle,
                p1: subtitle || 'Happy Birthday!',
                p2: message || '愿所有美好如期而至',
                recipient,
                memory,
                delivery: sender,
                date: wishDate,
                theme,
                image: null,
                music: null
            };

            const imageFile = imageInput.files[0];
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    birthdayData.image = e.target.result;
                    handleMusicAndShow(birthdayData);
                };
                reader.onerror = () => {
                    console.warn('读取图片失败，将跳过背景图');
                    handleMusicAndShow(birthdayData);
                };
                reader.readAsDataURL(imageFile);
            } else {
                handleMusicAndShow(birthdayData);
            }
        });

        function handleMusicAndShow(data) {
            if (useDefaultMusic) {
                data.music = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
                showBirthdayPage(data);
            } else if (selectedMusic) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    data.music = event.target.result;
                    showBirthdayPage(data);
                };
                reader.onerror = () => {
                    console.warn('读取音乐失败，将以无背景音乐继续');
                    showBirthdayPage(data);
                };
                reader.readAsDataURL(selectedMusic);
            } else {
                showBirthdayPage(data);
            }
        }

        function copyBlessingToClipboard() {
            if (!lastBirthdayData) return;
            const lines = [
                lastBirthdayData.title,
                lastBirthdayData.p1,
                lastBirthdayData.p2,
                lastBirthdayData.memory,
                lastBirthdayData.delivery ? `—— ${lastBirthdayData.delivery} ——` : ''
            ].filter(Boolean);
            const content = lines.join('\n');

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(content)
                    .then(() => showShareToast('祝福内容已复制'))
                    .catch(() => showShareToast('复制失败，可手动选择文本'));
            } else {
                showShareToast('浏览器不支持自动复制，请手动选择文本');
            }
        }

        function showShareToast(message) {
            actionButtons.toast.textContent = message;
            actionButtons.toast.classList.add('visible');
            setTimeout(() => {
                actionButtons.toast.classList.remove('visible');
            }, 1800);
        }

        function applyTheme(themeKey) {
            const config = themeConfigs[themeKey] || themeConfigs.sunrise;
            birthdayPage.style.background = config.background;
            celebrationRefs.pattern.style.backgroundImage = config.pattern;
            celebrationRefs.pattern.style.opacity = 0.35;
            celebrationRefs.main.style.color = config.heading;
            celebrationRefs.sub1.style.color = config.sub;
            celebrationRefs.sub2.style.color = config.message;
            celebrationRefs.sub3.style.color = config.memory;
            celebrationRefs.sub3.classList.toggle('memory', true);
            celebrationRefs.sub4.style.color = config.sub;
            celebrationRefs.card.style.background = config.cardBackground;
            celebrationRefs.card.style.boxShadow = `0 35px 90px ${config.cardShadow}`;
            celebrationRefs.chip.style.background = `linear-gradient(120deg, ${config.chipBg}, ${config.chipBgAlt})`;
            celebrationRefs.chip.style.color = config.heading;
        }

        function setupAudio(data) {
            if (activeAudio) {
                activeAudio.pause();
                activeAudio.remove();
                activeAudio = null;
            }
            if (audioUnlockHandler) {
                birthdayPage.removeEventListener('click', audioUnlockHandler);
                audioUnlockHandler = null;
            }
            setMusicControlVisible(false);
            if (!data.music) return;

            const audio = document.createElement('audio');
            audio.src = data.music;
            audio.loop = true;
            audio.volume = 0.35;
            birthdayPage.appendChild(audio);
            activeAudio = audio;

            audio.addEventListener('play', () => {
                syncMusicToggleState();
            });
            audio.addEventListener('pause', () => {
                syncMusicToggleState();
            });

            audioUnlockHandler = () => {
                audio.play().catch(err => console.warn('音频播放需要用户交互：', err));
            };
            birthdayPage.addEventListener('click', audioUnlockHandler, { once: true });
            setMusicControlVisible(true);
            syncMusicToggleState();
        }

        function resetDynamicMedia() {
            celebrationRefs.media.classList.add('hidden');
            celebrationRefs.media.style.backgroundImage = '';
        }

        function showBirthdayPage(data) {
            lastBirthdayData = data;
            document.body.classList.add('is-celebrating');
            birthdayPage.style.display = 'block';

            celebrationRefs.main.textContent = data.title;
            celebrationRefs.sub1.textContent = data.p1;
            celebrationRefs.sub2.textContent = data.p2;
            celebrationRefs.sub3.textContent = data.memory || '';
            celebrationRefs.sub3.style.display = data.memory ? 'block' : 'none';
            celebrationRefs.sub4.textContent = data.delivery ? `—— ${data.delivery} ——` : '';
            celebrationRefs.sub4.style.display = data.delivery ? 'block' : 'none';
            celebrationRefs.recipient.textContent = data.recipient ? `送给 · ${data.recipient}` : '送给 · 最亲爱的TA';

            applyTheme(data.theme);
            celebrationRefs.chip.textContent = themeNames[data.theme] || themeNames.sunrise;
            celebrationRefs.date.textContent = data.date ? formatDate(data.date) : '今日 · Happy Day';
            resetDynamicMedia();

            if (data.image) {
                celebrationRefs.media.classList.remove('hidden');
                celebrationRefs.media.style.backgroundImage = `url(${data.image})`;
            } else {
                celebrationRefs.media.classList.add('hidden');
                celebrationRefs.media.style.backgroundImage = '';
            }

            setupAudio(data);
            startBirthdayAnimation();
            toggleLoading(false);
        }

        function resetToHome() {
            document.body.classList.remove('is-celebrating');
            birthdayPage.style.display = 'none';
            if (stopAnimation) {
                stopAnimation();
                stopAnimation = null;
            }
            resetDynamicMedia();
            if (activeAudio) {
                activeAudio.pause();
                activeAudio.remove();
                activeAudio = null;
            }
            if (audioUnlockHandler) {
                birthdayPage.removeEventListener('click', audioUnlockHandler);
                audioUnlockHandler = null;
            }
            setMusicControlVisible(false);
            toggleLoading(false);
        }

        function startBirthdayAnimation() {
            if (stopAnimation) {
                stopAnimation();
                stopAnimation = null;
            }

            const canvas = document.getElementById('cakeCanvas');
            const ctx = canvas.getContext('2d');
            let w, h, centerX, centerY;
            let animationFrameId;

            function resize() {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
                centerX = w / 2;
                centerY = h / 2 + 120;
            }

            resize();
            window.addEventListener('resize', resize);

            class Particle {
                constructor(targetX, targetY, color, delay) {
                    this.startX = centerX;
                    this.startY = centerY;
                    this.x = this.startX;
                    this.y = this.startY;
                    this.targetX = targetX;
                    this.targetY = targetY;
                    this.color = color;
                    this.size = 2.2 + Math.random() * 1.3;
                    this.speed = 0.015 + Math.random() * 0.01;
                    this.progress = 0;
                    this.delay = delay;
                    this.active = false;
                    this.trail = [];
                    this.maxTrail = 6;
                }

                draw() {
                    if (this.trail.length > 1) {
                        ctx.beginPath();
                        ctx.moveTo(this.trail[0].x, this.trail[0].y);
                        for (let i = 1; i < this.trail.length; i++) {
                            ctx.lineTo(this.trail[i].x, this.trail[i].y);
                        }
                        ctx.strokeStyle = `${this.color}80`;
                        ctx.lineWidth = this.size * 0.7;
                        ctx.stroke();
                    }

                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }

                update(time) {
                    if (!this.active && time > this.delay) {
                        this.active = true;
                    }

                    if (this.active && this.progress < 1) {
                        this.progress += this.speed;
                        const ease = this.easeOutQuad(this.progress);
                        this.x = this.startX + (this.targetX - this.startX) * ease;
                        this.y = this.startY + (this.targetY - this.startY) * ease;

                        this.trail.push({ x: this.x, y: this.y });
                        if (this.trail.length > this.maxTrail) {
                            this.trail.shift();
                        }
                    }

                    if (this.active) {
                        this.draw();
                    }
                }

                easeOutQuad(t) {
                    return t * (2 - t);
                }
            }

            const cakePath = [];
            const colorGroups = [];

            function generateCakePath() {
                const baseWidth = 300;
                const baseHeight = 80;
                const midWidth = 250;
                const midHeight = 70;
                const topWidth = 200;
                const topHeight = 60;

                const baseY = centerY;
                for (let x = -baseWidth / 2; x <= baseWidth / 2; x += 5) {
                    cakePath.push({ x: centerX + x, y: baseY });
                    cakePath.push({ x: centerX + x, y: baseY - baseHeight });
                    colorGroups.push('base');
                    colorGroups.push('base');
                }
                for (let y = 0; y < baseHeight; y += 8) {
                    for (let x = -baseWidth / 2 + 10; x <= baseWidth / 2 - 10; x += 15) {
                        cakePath.push({ x: centerX + x, y: baseY - y });
                        colorGroups.push('base');
                    }
                }

                const frostingBottomY = baseY - baseHeight;
                for (let x = -baseWidth / 2 - 10; x <= baseWidth / 2 + 10; x += 5) {
                    cakePath.push({ x: centerX + x, y: frostingBottomY });
                    cakePath.push({ x: centerX + x, y: frostingBottomY - 20 });
                    colorGroups.push('frosting');
                    colorGroups.push('frosting');
                }

                const midY = frostingBottomY - 20;
                for (let x = -midWidth / 2; x <= midWidth / 2; x += 5) {
                    cakePath.push({ x: centerX + x, y: midY });
                    cakePath.push({ x: centerX + x, y: midY - midHeight });
                    colorGroups.push('middle');
                    colorGroups.push('middle');
                }
                for (let y = 0; y < midHeight; y += 8) {
                    for (let x = -midWidth / 2 + 10; x <= midWidth / 2 - 10; x += 15) {
                        cakePath.push({ x: centerX + x, y: midY - y });
                        colorGroups.push('middle');
                    }
                }

                const frostingMidY = midY - midHeight;
                for (let x = -midWidth / 2 - 10; x <= midWidth / 2 + 10; x += 5) {
                    cakePath.push({ x: centerX + x, y: frostingMidY });
                    cakePath.push({ x: centerX + x, y: frostingMidY - 18 });
                    colorGroups.push('frosting');
                    colorGroups.push('frosting');
                }

                const topY = frostingMidY - 18;
                for (let x = -topWidth / 2; x <= topWidth / 2; x += 5) {
                    cakePath.push({ x: centerX + x, y: topY });
                    cakePath.push({ x: centerX + x, y: topY - topHeight });
                    colorGroups.push('top');
                    colorGroups.push('top');
                }
                for (let y = 0; y < topHeight; y += 8) {
                    for (let x = -topWidth / 2 + 10; x <= topWidth / 2 - 10; x += 15) {
                        cakePath.push({ x: centerX + x, y: topY - y });
                        colorGroups.push('top');
                    }
                }

                const frostingTopY = topY - topHeight;
                const topFrostingWidth = topWidth + 20;
                for (let x = -topFrostingWidth / 2; x <= topFrostingWidth / 2; x += 4) {
                    const curve = Math.sin((x / (topFrostingWidth / 2)) * Math.PI / 2) * 15;
                    cakePath.push({
                        x: centerX + x,
                        y: frostingTopY - curve
                    });
                    colorGroups.push('frosting');
                }

                cakePath.push({ x: centerX, y: frostingTopY - 30 });
                colorGroups.push('cherry');
                cakePath.push({ x: centerX, y: frostingTopY - 45 });
                colorGroups.push('stem');
            }

            const colors = {
                base: ['#8b4513', '#a0522d', '#8b4513'],
                middle: ['#a0522d', '#cd853f', '#a0522d'],
                top: ['#cd853f', '#d2691e', '#cd853f'],
                frosting: ['#ffb6c1', '#ffc0cb', '#ffccd5'],
                cherry: ['#dc143c', '#b22222', '#8b0000'],
                stem: ['#228b22', '#2e8b57', '#3cb371']
            };

            const particles = [];
            let startTime = 0;

            function createCandles() {
                const candlesContainer = document.getElementById('candles');
                candlesContainer.innerHTML = '';
                const candlePositions = [-25, 15];

                candlePositions.forEach((x) => {
                    const candle = document.createElement('div');
                    candle.className = 'candle';
                    candle.style.left = `${centerX + x}px`;
                    candle.style.top = `${centerY - 320}px`;

                    const holder = document.createElement('div');
                    holder.className = 'candle-holder';
                    candle.appendChild(holder);

                    const wick = document.createElement('div');
                    wick.className = 'candle-wick';
                    candle.appendChild(wick);

                    const flame = document.createElement('div');
                    flame.className = 'flame';
                    candle.appendChild(flame);

                    candlesContainer.appendChild(candle);
                });

                setTimeout(() => {
                    document.querySelectorAll('.candle').forEach(candle => {
                        candle.style.transform = 'scaleY(1)';
                    });
                    setTimeout(() => {
                        document.querySelectorAll('.flame').forEach(flame => {
                            flame.style.opacity = 1;
                        });
                    }, 500);
                }, 3800);
            }

            function createSprinkles() {
                const container = document.getElementById('sprinklesContainer');
                container.innerHTML = '';
                const sprinkleColors = ['#ff6b6b', '#06d6a0', '#118ab2', '#ef476f', '#ffd166'];

                for (let i = 0; i < 50; i++) {
                    const sprinkle = document.createElement('div');
                    sprinkle.className = 'sprinkle';
                    sprinkle.style.background = sprinkleColors[Math.floor(Math.random() * sprinkleColors.length)];
                    sprinkle.style.left = `${centerX - 110 + Math.random() * 220}px`;
                    sprinkle.style.top = `${centerY - 230 + Math.random() * 100}px`;
                    sprinkle.style.transform = `rotate(${Math.random() * 360}deg)`;

                    if (Math.random() > 0.5) {
                        sprinkle.style.width = `${Math.random() * 10 + 5}px`;
                        sprinkle.style.height = `${Math.random() * 3 + 2}px`;
                    }

                    container.appendChild(sprinkle);

                    setTimeout(() => {
                        sprinkle.style.opacity = 1;
                        sprinkle.style.transform = `rotate(${Math.random() * 360}deg) translateY(0)`;
                    }, 2000 + i * 30);
                }
            }

            function createFallingDecorations() {
                const container = document.getElementById('fallingDecor');
                container.innerHTML = '';
                const elements = ['🎀', '🍓', '💖', '🍬', '🌸', '✨'];
                const count = 30;

                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const decor = document.createElement('div');
                        decor.className = 'falling';
                        decor.textContent = elements[Math.floor(Math.random() * elements.length)];
                        decor.style.fontSize = `${10 + Math.random() * 16}px`;
                        decor.style.left = `${Math.random() * 100}%`;
                        decor.style.top = `-${Math.random() * 20}%`;
                        decor.style.animationDuration = `${5 + Math.random() * 10}s`;
                        decor.style.animationDelay = `${Math.random() * 3}s`;
                        container.appendChild(decor);
                    }, i * 200);
                }
            }

            function createFloatingElements() {
                const container = document.getElementById('floatContainer');
                container.innerHTML = '';
                const elements = ['🎂', '🍰', '🎉', '🎈', '🍭', '🍬'];

                setTimeout(() => {
                    elements.forEach((el, i) => {
                        setTimeout(() => {
                            const floatEl = document.createElement('div');
                            floatEl.className = 'floating';
                            floatEl.textContent = el;
                            floatEl.style.fontSize = `${20 + Math.random() * 24}px`;
                            floatEl.style.left = `${5 + Math.random() * 90}%`;
                            floatEl.style.top = `${5 + Math.random() * 90}%`;
                            floatEl.style.animation = `float ${6 + Math.random() * 8}s infinite ease-in-out`;
                            floatEl.style.animationDelay = `${Math.random() * 4}s`;
                            container.appendChild(floatEl);

                            setTimeout(() => {
                                floatEl.style.opacity = 0.9;
                                floatEl.style.transform = 'scale(1) translateY(0)';
                            }, 100);
                        }, i * 200);
                    });
                }, 1500);
            }

            function setupTextAnimations() {
                const { main, sub1, sub2, sub3, sub4 } = celebrationRefs;
                [main, sub1, sub2, sub3, sub4].forEach(el => {
                    el.style.opacity = 0;
                    el.style.transform = 'translateY(20px)';
                });
                sub3.style.display = sub3.textContent ? 'block' : 'none';
                sub4.style.display = sub4.textContent ? 'block' : 'none';

                setTimeout(() => {
                    main.style.opacity = 1;
                    main.style.transform = 'translateY(0)';
                    main.style.animation = 'pulse 3s infinite';
                }, 4500);

                setTimeout(() => {
                    sub1.style.opacity = 1;
                    sub1.style.transform = 'translateY(0)';
                }, 5000);

                setTimeout(() => {
                    sub2.style.opacity = 1;
                    sub2.style.transform = 'translateY(0)';
                }, 5300);

                if (sub3.textContent) {
                    setTimeout(() => {
                        sub3.style.opacity = 1;
                        sub3.style.transform = 'translateY(0)';
                    }, 5600);
                }

                if (sub4.textContent) {
                    setTimeout(() => {
                        sub4.style.opacity = 1;
                        sub4.style.transform = 'translateY(0)';
                    }, 5900);
                }
            }

            function animate() {
                ctx.clearRect(0, 0, w, h);
                const time = Date.now() - startTime;

                particles.forEach(particle => {
                    particle.update(time);
                });

                animationFrameId = requestAnimationFrame(animate);
            }

            generateCakePath();
            createCandles();
            createSprinkles();
            createFallingDecorations();
            createFloatingElements();
            setupTextAnimations();

            const layerDelays = {
                base: 500,
                frosting: 1200,
                middle: 1700,
                top: 2300,
                cherry: 2800,
                stem: 3100
            };

            cakePath.forEach((point, index) => {
                const group = colorGroups[index];
                const palette = colors[group] || colors.base;
                const color = palette[Math.floor(Math.random() * palette.length)];
                const delay = (layerDelays[group] || 500) + index * 2;
                particles.push(new Particle(point.x, point.y, color, delay));
            });

            startTime = Date.now();
            animate();

            stopAnimation = () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                window.removeEventListener('resize', resize);
            };
        }
    </script>
</body>
</html>